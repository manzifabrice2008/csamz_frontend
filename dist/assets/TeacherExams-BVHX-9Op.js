import{c as z,r as o,d as Z,j as e}from"./index-DO3DQyOj.js";import{L as ee}from"./Layout-CrlmADHv.js";import{C as M,a as F,b as q,d as I,c as P}from"./card-C9br3U49.js";import{I as h}from"./input-B8EiBX5x.js";import{T as D}from"./textarea-DcEojWQk.js";import{B as j}from"./Combination-CmbmT9KT.js";import{B as m}from"./badge-ikHMzMmi.js";import{S as A}from"./separator-iGe6MMcL.js";import{t as te,c as p}from"./api-D9lEpycP.js";import{L as b}from"./loader-circle-BtKAsjRv.js";import{C as se}from"./circle-plus-D-AU5jgv.js";import{S as ae}from"./square-pen-B3paAdo2.js";import{T as re}from"./trash-2-CYBM7sb9.js";import{C as ie}from"./circle-check-ClT28XHX.js";import"./ThemeToggle-D7luiHAO.js";import"./index-B0Ri7ZjS.js";import"./globe-D0JlWi5d.js";import"./index-bF6N7R3r.js";import"./phone-Cfx4KfSj.js";import"./house-DEd3rU29.js";import"./image-BzTYbBvL.js";import"./user-CsuowrF_.js";import"./map-pin-D6wV0YeO.js";import"./auth-yvpDPXXe.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=z("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=z("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]]),O={id:0,question_text:"",type:"MCQ",options:["","","",""],correct_answer:"",marks:1};function Me(){const a=o.useMemo(()=>te.getStoredTeacher(),[]),{toast:r}=Z(),[y,N]=o.useState([]),[B,w]=o.useState(!0),[x,U]=o.useState(null),[i,H]=o.useState(null),[k,R]=o.useState([]),[$,C]=o.useState(!1),[_,E]=o.useState(!1),[l,u]=o.useState({title:"",description:"",total_marks:0,exam_code:"",level:"L3",trade:(a==null?void 0:a.trade)||""}),[n,d]=o.useState({...O}),[v,Q]=o.useState(null),[S,T]=o.useState(!1);o.useEffect(()=>{if(!(a!=null&&a.id))return;(async()=>{try{w(!0);const t=await p.list(a.id);N(t.exams),t.exams.length&&!x&&g(t.exams[0].id)}catch(t){r({title:"Failed to load exams",description:(t==null?void 0:t.message)||"Please try again later.",variant:"destructive"})}finally{w(!1)}})()},[a==null?void 0:a.id]);const G=async()=>{if(!(a!=null&&a.id))return;const s=await p.list(a.id);N(s.exams)},g=async s=>{U(s),C(!0);try{const t=await p.getManageDetail(s);H({id:t.exam.id,title:t.exam.title,description:t.exam.description,total_marks:t.exam.total_marks,exam_code:t.exam.exam_code||null,trade:t.exam.trade||null,level:t.exam.level||"L3",teacher_name:t.exam.teacher_name||null}),R(t.questions)}catch(t){r({title:"Failed to load exam",description:(t==null?void 0:t.message)||"Please try again.",variant:"destructive"})}finally{C(!1)}},V=async s=>{if(s.preventDefault(),!l.title.trim()){r({title:"Exam title is required",variant:"destructive"});return}if(!l.trade){r({title:"Please select a trade",variant:"destructive"});return}try{E(!0),await p.create({title:l.title.trim(),description:l.description.trim()||void 0,total_marks:Number(l.total_marks)||0,exam_code:l.exam_code.trim()||void 0,level:l.level,trade:l.trade}),r({title:"Exam created",description:"Share the exam code with students."}),u({title:"",description:"",total_marks:0,exam_code:"",level:"L3",trade:(a==null?void 0:a.trade)||""}),await G()}catch(t){r({title:"Could not create exam",description:(t==null?void 0:t.message)||"Please check your details and try again.",variant:"destructive"})}finally{E(!1)}},X=async s=>{if(s.preventDefault(),!x){r({title:"Select an exam first",variant:"destructive"});return}const t={question_text:n.question_text.trim(),type:n.type,correct_answer:n.correct_answer.trim(),marks:Number(n.marks)||1};if(!t.question_text){r({title:"Question text is required",variant:"destructive"});return}if(n.type==="MCQ"){const c=n.options.map(f=>f.trim()).filter(Boolean);if(c.length<2){r({title:"Provide at least two options",variant:"destructive"});return}if(!c.includes(t.correct_answer)){r({title:"Correct answer must match one of the options",variant:"destructive"});return}t.options=c}else t.correct_answer=["true","false"].includes(t.correct_answer.toLowerCase())?t.correct_answer:"True";try{T(!0),v?(await p.updateQuestion(v,t),r({title:"Question updated"})):(await p.addQuestion(x,t),r({title:"Question added"})),await g(x),L()}catch(c){r({title:"Failed to save question",description:(c==null?void 0:c.message)||"Try again.",variant:"destructive"})}finally{T(!1)}},Y=s=>{Q(s.id),d({id:s.id,question_text:s.question_text,type:s.type,options:s.type==="MCQ"?[...s.options]:["","","",""],correct_answer:s.correct_answer,marks:s.marks})},J=async s=>{if(x&&confirm("Delete this question?"))try{await p.deleteQuestion(s),r({title:"Question removed"}),await g(x)}catch(t){r({title:"Deletion failed",description:(t==null?void 0:t.message)||"Try again.",variant:"destructive"})}},L=()=>{Q(null),d({...O})},K=()=>{i!=null&&i.exam_code&&(navigator.clipboard.writeText(i.exam_code),r({title:"Exam code copied"}))};return e.jsx(ee,{children:e.jsx("section",{className:"py-16 px-4 bg-muted/30 min-h-screen",children:e.jsxs("div",{className:"container mx-auto max-w-6xl space-y-8",children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx(m,{className:"bg-school-primary/10 text-school-primary dark:bg-school-accent/10 dark:text-school-accent",children:"Teacher Exams"}),e.jsx("h1",{className:"text-3xl font-bold gradient-text",children:"Prepare and manage online assessments"}),(a==null?void 0:a.trade)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Linked trade: ",a.trade,". Students in this trade will see your exams."]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.1fr_0.9fr]",children:[e.jsxs(M,{className:"shadow-lg",children:[e.jsxs(F,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-school-primary"}),"Create or select an exam"]}),e.jsx(I,{children:"Generate an exam code automatically or choose your own."})]}),e.jsxs(P,{className:"space-y-6",children:[e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Exam title"}),e.jsx(h,{value:l.title,onChange:s=>u(t=>({...t,title:s.target.value})),placeholder:"e.g. Software Development Mock Test",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Description"}),e.jsx(D,{value:l.description,onChange:s=>u(t=>({...t,description:s.target.value})),placeholder:"Optional overview for students"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Total marks"}),e.jsx(h,{type:"number",min:0,value:l.total_marks,onChange:s=>u(t=>({...t,total_marks:Number(s.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Custom exam code (optional)"}),e.jsx(h,{value:l.exam_code,onChange:s=>u(t=>({...t,exam_code:s.target.value.toUpperCase()})),placeholder:"EX-ABC123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Level"}),e.jsxs("select",{value:l.level,onChange:s=>u(t=>({...t,level:s.target.value})),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"L3",children:"Level 3"}),e.jsx("option",{value:"L4",children:"Level 4"}),e.jsx("option",{value:"L5",children:"Level 5"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Trade"}),e.jsx(h,{value:l.trade,onChange:s=>u(t=>({...t,trade:s.target.value})),placeholder:"Enter trade name",required:!0})]})]}),e.jsx(j,{type:"submit",className:"w-full",disabled:_,children:_?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 animate-spin mr-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Create exam"]})})]}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Your exams"}),B?e.jsxs("div",{className:"flex items-center justify-center py-8 text-muted-foreground",children:[e.jsx(b,{className:"w-5 h-5 animate-spin mr-2"}),"Loading exams..."]}):y.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No exams yet. Create one to get started."}):e.jsx("div",{className:"space-y-3 max-h-[420px] overflow-auto pr-1",children:y.map(s=>e.jsxs("button",{onClick:()=>g(s.id),className:`w-full text-left border rounded-lg p-4 transition ${x===s.id?"border-school-primary bg-school-primary/5":"border-border hover:border-school-primary/60"}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium",children:s.title}),s.exam_code&&e.jsx(m,{variant:"outline",className:"text-xs",children:s.exam_code})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(m,{variant:"secondary",className:"text-xs",children:s.trade||"No Trade"}),e.jsx(m,{variant:"secondary",className:"text-xs",children:s.level||"No Level"})]})]}),e.jsx("div",{className:"flex items-center justify-between mt-2",children:e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.question_count??0," questions • ",s.total_marks," marks"]})})})]},s.id))})]})]})]}),e.jsxs(M,{className:"shadow-lg",children:[e.jsxs(F,{children:[e.jsx(q,{children:"Exam questions"}),e.jsx(I,{children:i?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:i.title}),i.exam_code&&e.jsxs("button",{type:"button",onClick:K,className:"inline-flex items-center gap-1 text-xs text-school-primary hover:underline",children:[e.jsx(le,{className:"w-3 h-3"}),i.exam_code]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i.trade&&e.jsx(m,{variant:"secondary",className:"text-xs",children:i.trade}),e.jsx(m,{variant:"secondary",className:"text-xs",children:i.level}),i.teacher_name&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["by ",i.teacher_name]})]})]}):"Select an exam to view and edit questions."})]}),e.jsx(P,{className:"space-y-6",children:$?e.jsxs("div",{className:"flex items-center justify-center py-10 text-muted-foreground",children:[e.jsx(b,{className:"w-6 h-6 animate-spin mr-2"}),"Loading questions..."]}):i?e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"space-y-4",onSubmit:X,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg",children:v?"Edit question":"Add new question"}),v&&e.jsx(j,{variant:"ghost",size:"sm",onClick:L,children:"Cancel edit"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Question text"}),e.jsx(D,{value:n.question_text,onChange:s=>d(t=>({...t,question_text:s.target.value})),required:!0,placeholder:"Enter the question"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Question type"}),e.jsxs("select",{value:n.type,onChange:s=>{const t=s.target.value;d(c=>({...c,type:t,correct_answer:t==="TF"?"True":c.correct_answer}))},className:"w-full rounded-md border border-border bg-background px-3 py-2",children:[e.jsx("option",{value:"MCQ",children:"Multiple choice"}),e.jsx("option",{value:"TF",children:"True / False"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Marks"}),e.jsx(h,{type:"number",min:1,value:n.marks,onChange:s=>d(t=>({...t,marks:Number(s.target.value)}))})]})]}),n.type==="MCQ"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium block",children:"Options"}),n.options.map((s,t)=>e.jsx(h,{value:s,placeholder:`Option ${t+1}`,onChange:c=>{const f=[...n.options];f[t]=c.target.value,d(W=>({...W,options:f}))}},t)),e.jsx("label",{className:"text-sm font-medium block mt-2",children:"Correct answer"}),e.jsx(h,{value:n.correct_answer,onChange:s=>d(t=>({...t,correct_answer:s.target.value})),placeholder:"Must match one of the options"})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Correct answer"}),e.jsxs("select",{value:n.correct_answer||"True",onChange:s=>d(t=>({...t,correct_answer:s.target.value})),className:"w-full rounded-md border border-border bg-background px-3 py-2",children:[e.jsx("option",{value:"True",children:"True"}),e.jsx("option",{value:"False",children:"False"})]})]}),e.jsx(j,{type:"submit",className:"w-full",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 animate-spin mr-2"}),"Saving..."]}):v?"Update question":"Add question"})]}),e.jsx(A,{}),e.jsx("div",{className:"space-y-4 max-h-[420px] overflow-auto pr-1",children:k.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No questions yet. Add one above."}):k.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.question_text}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.type==="MCQ"?"Multiple choice":"True / False"," • ",s.marks," marks"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>Y(s),children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>J(s.id),children:e.jsx(re,{className:"w-4 h-4"})})]})]}),s.type==="MCQ"?e.jsx("ul",{className:"list-disc pl-5 text-sm space-y-1",children:s.options.map(t=>e.jsxs("li",{className:"flex items-center gap-2",children:[t,t===s.correct_answer&&e.jsxs(m,{variant:"outline",className:"text-emerald-600 border-emerald-200",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),"Correct"]})]},t))}):e.jsxs("p",{className:"text-sm",children:["Correct answer:"," ",e.jsx(m,{variant:"outline",className:"ml-2",children:s.correct_answer})]})]},s.id))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select an exam to begin editing questions."})})]})]})]})})})}export{Me as default};
