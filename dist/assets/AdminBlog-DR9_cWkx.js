import{d as Z,r,j as e,X as ee}from"./index-DO3DQyOj.js";import{A as se}from"./AdminLayout-BJsapQL8.js";import{B as c}from"./Combination-CmbmT9KT.js";import{I as f}from"./input-B8EiBX5x.js";import{T as A}from"./textarea-DcEojWQk.js";import{C as L,a as D,b as R,c as U}from"./card-C9br3U49.js";import{R as te,T as ae,a as le,b as $,c as u,d as ie,e as h}from"./table-BRiVma7i.js";import{S as re}from"./switch-BOhQqRY5.js";import{b as w,A as M}from"./api-D9lEpycP.js";import{g as ne}from"./auth-yvpDPXXe.js";import{P as ce}from"./plus-C8mFMtAq.js";import{I as oe}from"./image-BzTYbBvL.js";import{L as C}from"./loader-circle-BtKAsjRv.js";import{S as de}from"./square-pen-B3paAdo2.js";import{T as me}from"./trash-2-CYBM7sb9.js";import"./ThemeToggle-D7luiHAO.js";import"./settings-C2rD9Q76.js";import"./chevron-left-Wbh9FitJ.js";import"./users-u0NU3Vz3.js";import"./index-bF6N7R3r.js";const q={title:"",slug:"",excerpt:"",content:"",cover_image:"",published_date:new Date().toISOString().slice(0,10),is_published:!0},z=a=>a.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),H=a=>{if(!a||a.trim()==="")return"";if(/^https?:\/\//i.test(a))return a;const o=M.replace(/\/api$/,"");return a.startsWith("/")?`${o}${a}`:`${o}/${a}`};function Fe(){const{toast:a}=Z(),[o,O]=r.useState([]),[i,j]=r.useState(!1),[y,_]=r.useState(!0),[P,T]=r.useState(null),[l,d]=r.useState(q),[b,k]=r.useState(!1),[v,W]=r.useState(""),[N,E]=r.useState(!1),[S,x]=r.useState(null),m=r.useRef(null),B=r.useMemo(()=>{if(!v.trim())return o;const s=v.toLowerCase();return o.filter(t=>[t.title,t.slug,t.excerpt,t.author_name].filter(Boolean).some(n=>n.toLowerCase().includes(s)))},[o,v]),g=async()=>{try{_(!0);const s=await w.adminList();O(s.posts),T(null)}catch(s){T(s.message||"Failed to load blog posts"),a({title:"Error",description:s.message||"Failed to load blog posts",variant:"destructive"})}finally{_(!1)}};r.useEffect(()=>{g()},[]);const F=()=>{d(q),k(!1),x(null),m.current&&(m.current.value="")},X=s=>{d({id:s.id,title:s.title,slug:s.slug,excerpt:s.excerpt,content:s.content,cover_image:s.cover_image||"",published_date:s.published_date,is_published:s.is_published}),x(H(s.cover_image)),k(!0),window.scrollTo({top:0,behavior:"smooth"})},G=async s=>{if(confirm(`Delete blog post "${s.title}"?`))try{j(!0),await w.delete(s.id),a({title:"Deleted",description:"Blog post removed successfully."}),g()}catch(t){a({title:"Error",description:t.message||"Failed to delete blog post",variant:"destructive"})}finally{j(!1)}},J=async s=>{s.preventDefault(),j(!0);try{const t={title:l.title,slug:l.slug,excerpt:l.excerpt,content:l.content,cover_image:l.cover_image.trim(),published_date:l.published_date,is_published:l.is_published};l.id?(await w.update(l.id,t),a({title:"Updated",description:"Blog post updated successfully."})):(await w.create(t),a({title:"Created",description:"Blog post created successfully."})),F(),g()}catch(t){a({title:"Error",description:t.message||"Failed to save blog post",variant:"destructive"})}finally{j(!1)}},p=(s,t)=>{d(n=>({...n,[s]:t}))},K=s=>{d(t=>({...t,title:s,slug:t.id?t.slug:z(s)}))},Q=async s=>{const t=new FormData;t.append("image",s);const n=await fetch(`${M}/upload/image`,{method:"POST",headers:{Authorization:`Bearer ${ne()}`||""},body:t});if(!n.ok)throw new Error("Image upload failed");return(await n.json()).url},V=async s=>{if(!s.target.files||!s.target.files[0])return;const t=s.target.files[0];E(!0);try{const n=await Q(t);d(I=>({...I,cover_image:n})),x(H(n)),a({title:"Uploaded",description:"Cover image uploaded successfully."})}catch(n){a({title:"Error",description:n.message||"Failed to upload image",variant:"destructive"})}finally{E(!1)}},Y=()=>{d(s=>({...s,cover_image:""})),x(null),m.current&&(m.current.value="")};return e.jsx(se,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold gradient-text",children:b?"Edit Blog Post":"Create Blog Post"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage stories, insights, and updates for the CSAM blog."})]}),e.jsxs(c,{type:"button",variant:"outline",onClick:g,disabled:y,children:[e.jsx(te,{className:`w-4 h-4 mr-2 ${y?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs(L,{className:"shadow-lg",children:[e.jsx(D,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),b?"Update Blog Post":"New Blog Post"]})}),e.jsx(U,{children:e.jsxs("form",{className:"space-y-5",onSubmit:J,children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Title"}),e.jsx(f,{value:l.title,onChange:s=>K(s.target.value),placeholder:"Enter blog post title",required:!0,disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Slug"}),e.jsx(f,{value:l.slug,onChange:s=>p("slug",z(s.target.value)),placeholder:"unique-slug",required:!0,disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Published Date"}),e.jsx(f,{type:"date",value:l.published_date,onChange:s=>p("published_date",s.target.value),required:!0,disabled:i})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{id:"is_published",checked:l.is_published,onCheckedChange:s=>p("is_published",s),disabled:i}),e.jsx("label",{htmlFor:"is_published",className:"text-sm font-medium",children:"Published"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Excerpt"}),e.jsx(A,{value:l.excerpt,onChange:s=>p("excerpt",s.target.value),placeholder:"Short summary that appears on the blog listing...",required:!0,disabled:i,className:"min-h-[120px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",children:"Cover Image"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-48 h-32 border border-dashed rounded-md flex items-center justify-center overflow-hidden bg-muted/40",children:[S?e.jsx("img",{src:S,alt:"Cover preview",className:"w-full h-full object-cover",onError:s=>{s.target.src="",x(null)}}):e.jsxs("div",{className:"flex flex-col items-center text-muted-foreground text-sm",children:[e.jsx(oe,{className:"w-6 h-6 mb-2"}),e.jsx("span",{children:"No image"})]}),N&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:e.jsx(C,{className:"w-6 h-6 text-white animate-spin"})}),S&&!N&&e.jsx("button",{type:"button",className:"absolute top-1 right-1 bg-black/60 text-white rounded-full p-1",onClick:Y,title:"Remove image",children:e.jsx(ee,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:V,ref:m}),e.jsx(c,{type:"button",variant:"outline",onClick:()=>{var s;return(s=m.current)==null?void 0:s.click()},disabled:i||N,className:"w-full sm:w-auto",children:N?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"})," Uploading..."]}):"Upload Cover Image"}),l.cover_image&&e.jsx(f,{value:l.cover_image,readOnly:!0,className:"w-full sm:w-72 text-xs text-muted-foreground"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Content"}),e.jsx(A,{value:l.content,onChange:s=>p("content",s.target.value),placeholder:"Write the full blog content here...",required:!0,disabled:i,className:"min-h-[240px]"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(c,{type:"submit",disabled:i,className:"flex-1",children:i?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):b?"Update Post":"Create Post"}),b&&e.jsx(c,{type:"button",variant:"outline",onClick:F,disabled:i,children:"Cancel"})]})]})})]}),e.jsxs(L,{className:"shadow-lg",children:[e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx(R,{className:"text-2xl",children:"Existing Posts"}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(f,{placeholder:"Search posts...",value:v,onChange:s=>W(s.target.value),className:"w-full md:w-64"})})]})}),e.jsx(U,{children:y?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(C,{className:"w-6 h-6 mr-2 animate-spin"}),e.jsx("span",{children:"Loading posts..."})]}):P?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("p",{className:"text-red-500 font-medium",children:P}),e.jsx(c,{variant:"outline",className:"mt-4",onClick:g,children:"Retry"})]}):B.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"No blog posts yet. Create your first article above."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ae,{children:[e.jsx(le,{children:e.jsxs($,{children:[e.jsx(u,{children:"Title"}),e.jsx(u,{children:"Slug"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Published"}),e.jsx(u,{children:"Author"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(ie,{children:B.map(s=>e.jsxs($,{children:[e.jsxs(h,{children:[e.jsx("div",{className:"font-semibold text-foreground",children:s.title}),e.jsx("div",{className:"text-xs text-muted-foreground line-clamp-2",children:s.excerpt})]}),e.jsx(h,{children:s.slug}),e.jsx(h,{children:s.is_published?"Published":"Draft"}),e.jsx(h,{children:new Date(s.published_date).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}),e.jsx(h,{children:s.author_name||"â€”"}),e.jsxs(h,{className:"text-right space-x-2",children:[e.jsx(c,{size:"icon",variant:"outline",onClick:()=>X(s),disabled:i,children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(c,{size:"icon",variant:"destructive",onClick:()=>G(s),disabled:i,children:e.jsx(me,{className:"w-4 h-4"})})]})]},s.id))})]})})})]})]})})})}export{Fe as default};
