import{b as O,a as T,r,j as e}from"./index-CzeJB2_e.js";import{S as x}from"./StudentLayout-DdLerGO8.js";import{B as I}from"./badge-C-oA49Ek.js";import{B as u}from"./ThemeToggle-D2hc9s20.js";import{C as f,a as b,b as g,d as y,c as Q}from"./card-BsroX09w.js";import{S as P}from"./separator-BO46W0Pz.js";import{g as N}from"./api-lJrYn1A1.js";import{L as v}from"./loader-circle-C8GZr3XQ.js";import{C as _}from"./circle-alert-Bd5S8RAp.js";import{A as w}from"./arrow-left-hwJQProB.js";import"./avatar-AnT28iLS.js";import"./index-CMcuwscu.js";import"./settings-Bfsz5ImR.js";import"./chevron-left-DDaN3q0X.js";import"./bell-Ckq7fT2u.js";import"./user-CRAUHVsN.js";import"./award-DJdeNQEu.js";import"./auth-yvpDPXXe.js";function ae(){const{examId:n}=O(),m=T(),[l,k]=r.useState(null),[d,S]=r.useState([]),[C,p]=r.useState(!0),[o,i]=r.useState(null),[c,E]=r.useState({}),[h,j]=r.useState(!1);r.useEffect(()=>{(async()=>{if(!n){i("Invalid exam id."),p(!1);return}try{const t=await N.getQuestions(Number(n));k(t.exam),S(t.questions)}catch(t){i((t==null?void 0:t.message)||"Failed to load exam questions.")}finally{p(!1)}})()},[n]);const A=r.useMemo(()=>Object.keys(c).length,[c]),L=(a,t)=>{E(s=>({...s,[a]:t}))},B=async a=>{if(a.preventDefault(),!n){i("Invalid exam id.");return}if(Object.keys(c).length===0){i("Please answer at least one question before submitting.");return}j(!0),i(null);const t={answers:Object.entries(c).map(([s,F])=>({questionId:Number(s),answer:F}))};try{const s=await N.submitAnswers(Number(n),t);m(`/student/exams/${n}/result`,{state:{fromSubmission:!0,score:s.score,totalMarks:s.total_marks},replace:!0})}catch(s){i((s==null?void 0:s.message)||"Failed to submit exam. Please try again.")}finally{j(!1)}};return C?e.jsx(x,{children:e.jsx("section",{className:"py-8 px-4",children:e.jsx("div",{className:"container mx-auto flex justify-center py-20",children:e.jsx(v,{className:"w-8 h-8 animate-spin text-school-primary","aria-label":"Loading exam"})})})}):o?e.jsx(x,{children:e.jsx("section",{className:"py-8 px-4",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsx(f,{className:"border-destructive/30",children:e.jsxs(b,{className:"space-y-3 text-center",children:[e.jsxs(g,{className:"text-destructive flex items-center justify-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Unable to load exam"]}),e.jsx(y,{children:o}),e.jsxs(u,{variant:"outline",onClick:()=>m(-1),className:"inline-flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),"Go back"]})]})})})})}):l?e.jsx(x,{children:e.jsx("section",{className:"py-8 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-4xl space-y-8",children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx(I,{className:"bg-school-primary/10 text-school-primary dark:bg-school-accent/10 dark:text-school-accent",children:"Online Exam"}),e.jsx("h1",{className:"text-3xl font-bold gradient-text",children:l.title}),l.description&&e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:l.description}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Answer all questions and submit to see your score instantly. Total marks: ",l.total_marks,"."]})]}),e.jsxs(f,{children:[e.jsxs(b,{children:[e.jsx(g,{children:"Questions"}),e.jsxs(y,{children:[d.length," question",d.length===1?"":"s"," â€¢ ",A," answered"]})]}),e.jsx(P,{}),e.jsx(Q,{children:e.jsxs("form",{className:"space-y-8",onSubmit:B,children:[d.map((a,t)=>e.jsxs("div",{className:"space-y-4 border border-border/80 rounded-lg p-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Question ",t+1]}),e.jsx("p",{className:"text-lg font-semibold",children:a.question_text}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Worth ",a.marks," mark",a.marks===1?"":"s"]})]}),e.jsx("div",{className:"space-y-2",children:(a.type==="TF"?["True","False"]:a.options).map(s=>e.jsxs("label",{className:`flex items-center gap-3 rounded-md border px-3 py-2 cursor-pointer transition ${c[a.id]===s?"border-school-primary bg-school-primary/10 dark:border-school-accent dark:bg-school-accent/10":"border-border hover:border-school-primary/60"}`,children:[e.jsx("input",{type:"radio",name:`question-${a.id}`,value:s,checked:c[a.id]===s,onChange:()=>L(a.id,s),className:"h-4 w-4 accent-school-primary"}),e.jsx("span",{className:"text-sm",children:s})]},s))})]},a.id)),o&&e.jsx("div",{className:"rounded-md border border-destructive/30 bg-destructive/5 p-3 text-sm text-destructive",children:o}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(u,{type:"button",variant:"ghost",className:"flex items-center gap-2",onClick:()=>m(-1),children:[e.jsx(w,{className:"w-4 h-4"}),"Back to exams"]}),e.jsx(u,{type:"submit",className:"min-w-[180px]",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 animate-spin"}),"Submitting..."]}):"Submit Exam"})]})]})})]})]})})}):null}export{ae as default};
