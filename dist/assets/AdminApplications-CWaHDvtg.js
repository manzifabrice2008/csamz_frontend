import{c as me,r as a,d as xe,j as e,G as T}from"./index-CzeJB2_e.js";import{A as he,M as pe}from"./AdminLayout-e88jVYkQ.js";import{B as r}from"./ThemeToggle-D2hc9s20.js";import{T as ue}from"./textarea-pwDqsI7c.js";import{C as n,c,a as je,b as fe}from"./card-BsroX09w.js";import{B as g}from"./badge-C-oA49Ek.js";import{D as M,a as B,b as O,c as V,d as $,e as ge}from"./dialog-CkRlzZK3.js";import{S as z,a as G,b as I,c as U,d as o}from"./select-CWMO0rur.js";import{a as N,A as Ne}from"./api-lJrYn1A1.js";import{U as ve}from"./users-Dg6TI95m.js";import{C as q}from"./clock-6dAMR-Ce.js";import{C}from"./circle-check-big-5jgk6JlZ.js";import{C as _}from"./circle-x-CU3UCJ9x.js";import{L as H}from"./loader-circle-C8GZr3XQ.js";import{C as we}from"./circle-alert-Bd5S8RAp.js";import{P as Q}from"./phone-CnVUOyj2.js";import{M as W}from"./mail-5yJGIojy.js";import{C as be}from"./calendar-DGQQ9pRT.js";import{E as ye}from"./eye-Cppi58rk.js";import{F as X}from"./file-text-BxJWlFjv.js";import{T as Se}from"./trash-2-C6yUris8.js";import{M as Ae}from"./map-pin-DS4Hc9gx.js";import"./auth-yvpDPXXe.js";import"./settings-Bfsz5ImR.js";import"./chevron-left-DDaN3q0X.js";import"./newspaper-DUsPLaFp.js";import"./square-pen-BQHR_P_T.js";import"./index-BdQq_4o_.js";import"./index-BtVmVfNa.js";import"./chevron-up-DxfnO0xg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=me("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function as(){const[v,Y]=a.useState([]),[w,J]=a.useState([]),[d,x]=a.useState(!1),[K,k]=a.useState(!0),[D,F]=a.useState(null),[t,b]=a.useState(null),[Z,P]=a.useState(!1),[ee,h]=a.useState(!1),[l,se]=a.useState("approved"),[R,y]=a.useState(""),[p,te]=a.useState("all"),[u,ae]=a.useState("all"),{toast:m}=xe(),[j,re]=a.useState({total:0,pending:0,approved:0,rejected:0}),le=Ne.replace(/\/api\/?$/,""),S=s=>s.report_url?s.report_url:s.report_path?s.report_path.startsWith("http")?s.report_path:`${le}${s.report_path}`:null;a.useEffect(()=>{f(),A()},[]),a.useEffect(()=>{ie()},[v,p,u]);const f=async()=>{try{k(!0),F(null);const s=await N.getAll();Y(s.applications)}catch(s){F(s.message||"Failed to fetch applications"),m({title:"Error",description:s.message||"Failed to fetch applications",variant:"destructive"})}finally{k(!1)}},A=async()=>{try{const s=await N.getStats();re(s.stats)}catch(s){console.error("Failed to fetch stats:",s)}},ie=()=>{let s=[...v];p!=="all"&&(s=s.filter(i=>i.status===p)),u!=="all"&&(s=s.filter(i=>i.program===u)),J(s)},ne=s=>{b(s),P(!0)},E=(s,i)=>{b(s),se(i),y(""),h(!0)},ce=async()=>{if(t)try{x(!0);const s=await N.updateStatus(t.id,{status:l,admin_notes:R});m({title:"Success",description:`Application ${l}. ${s.sms_sent?"SMS notification sent to student.":"Student will be notified."}`}),await f(),await A(),h(!1),b(null),y("")}catch(s){m({title:"Error",description:s.message||"Failed to update application",variant:"destructive"})}finally{x(!1)}},de=async s=>{if(confirm("Are you sure you want to delete this application?"))try{x(!0),await N.delete(s),m({title:"Success",description:"Application deleted successfully"}),await f(),await A()}catch(i){m({title:"Error",description:i.message||"Failed to delete application",variant:"destructive"})}finally{x(!1)}},L=s=>{switch(s){case"pending":return e.jsxs(g,{variant:"outline",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),"Pending"]});case"approved":return e.jsxs(g,{variant:"outline",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Approved"]});case"rejected":return e.jsxs(g,{variant:"outline",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"Rejected"]});default:return e.jsx(g,{children:s})}},oe=Array.from(new Set(v.map(s=>s.program)));return e.jsxs(he,{children:[e.jsx("section",{className:"p-6",children:e.jsxs("div",{className:"container mx-auto max-w-7xl",children:[e.jsxs("div",{className:"mb-8 animate-fadeInDown",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:e.jsx("span",{className:"gradient-text",children:"Student Applications"})}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and review student applications"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(n,{className:"hover-lift",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Applications"}),e.jsx("p",{className:"text-3xl font-bold",children:j.total})]}),e.jsx(ve,{className:"w-10 h-10 text-school-primary opacity-50"})]})})}),e.jsx(n,{className:"hover-lift",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:j.pending})]}),e.jsx(q,{className:"w-10 h-10 text-yellow-600 opacity-50"})]})})}),e.jsx(n,{className:"hover-lift",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Approved"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:j.approved})]}),e.jsx(C,{className:"w-10 h-10 text-green-600 opacity-50"})]})})}),e.jsx(n,{className:"hover-lift",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rejected"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:j.rejected})]}),e.jsx(_,{className:"w-10 h-10 text-red-600 opacity-50"})]})})})]}),e.jsx(n,{className:"mb-8",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ce,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(z,{value:p,onValueChange:te,children:[e.jsx(G,{children:e.jsx(I,{placeholder:"Filter by status"})}),e.jsxs(U,{children:[e.jsx(o,{value:"all",children:"All Status"}),e.jsx(o,{value:"pending",children:"Pending"}),e.jsx(o,{value:"approved",children:"Approved"}),e.jsx(o,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(z,{value:u,onValueChange:ae,children:[e.jsx(G,{children:e.jsx(I,{placeholder:"Filter by program"})}),e.jsxs(U,{children:[e.jsx(o,{value:"all",children:"All Programs"}),oe.map(s=>e.jsx(o,{value:s,children:s},s))]})]})]})]})})}),e.jsxs(n,{className:"shadow-lg",children:[e.jsx(je,{children:e.jsxs(fe,{className:"text-2xl text-school-primary dark:text-school-accent",children:["Applications (",w.length,")"]})}),e.jsx(c,{children:K?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(H,{className:"w-8 h-8 animate-spin text-school-primary"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading applications..."})]}):D?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-red-500",children:[e.jsx(we,{className:"w-8 h-8 mb-2"}),e.jsx("p",{children:D}),e.jsx(r,{onClick:f,variant:"outline",className:"mt-4",children:"Retry"})]}):w.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No applications found."}):e.jsx("div",{className:"space-y-4",children:w.map(s=>e.jsx(n,{className:"hover-lift",children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-bold text-lg",children:s.full_name}),L(s.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),s.program]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),s.phone_number]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),s.email]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Applied: ",new Date(s.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>ne(s),children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"View"]}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>E(s,"approved"),disabled:d,className:"text-green-600 hover:bg-green-50 dark:hover:bg-green-900",children:[e.jsx(C,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>E(s,"rejected"),disabled:d,className:"text-red-600 hover:bg-red-50 dark:hover:bg-red-900",children:[e.jsx(_,{className:"w-4 h-4 mr-1"}),"Reject"]})]}),s.report_path&&e.jsx(r,{size:"sm",variant:"outline",asChild:!0,children:e.jsxs("a",{href:S(s)||"#",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(X,{className:"w-4 h-4 mr-1"}),"Report"]})}),e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>de(s.id),disabled:d,className:"text-red-600 hover:bg-red-50 dark:hover:bg-red-900",children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})})},s.id))})})]})]})}),e.jsx(M,{open:Z,onOpenChange:P,children:e.jsxs(B,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(O,{children:[e.jsx(V,{children:"Application Details"}),e.jsx($,{children:"Complete information about the student application"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:t.full_name}),L(t.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),t.email]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),t.phone_number]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Date of Birth"}),e.jsx("p",{children:new Date(t.date_of_birth).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Gender"}),e.jsx("p",{children:t.gender})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Address"}),e.jsxs("p",{className:"flex items-start gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 mt-1"}),t.address]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Program"}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),t.program]})]}),t.previous_school&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Previous School"}),e.jsx("p",{children:t.previous_school})]}),t.previous_qualification&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Previous Qualification"}),e.jsx("p",{children:t.previous_qualification})]}),t.guardian_name&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Guardian Name"}),e.jsx("p",{children:t.guardian_name})]}),t.guardian_phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Guardian Phone"}),e.jsx("p",{children:t.guardian_phone})]}),S(t)&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Academic Report"}),e.jsx(r,{variant:"outline",asChild:!0,className:"mt-2",children:e.jsxs("a",{href:S(t),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Download Report"]})})]}),t.admin_notes&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Admin Notes"}),e.jsx("p",{className:"bg-muted p-3 rounded",children:t.admin_notes})]}),t.approved_by_name&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Processed By"}),e.jsxs("p",{children:[t.approved_by_name," on ",new Date(t.approved_at).toLocaleString()]})]})]})]})]})}),e.jsx(M,{open:ee,onOpenChange:h,children:e.jsxs(B,{children:[e.jsxs(O,{children:[e.jsxs(V,{children:[l==="approved"?"Approve":"Reject"," Application"]}),e.jsx($,{children:l==="approved"?"The student will receive an SMS notification about the approval.":"The student will receive an SMS notification about the rejection."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Message to Student (Optional)"]}),e.jsx(ue,{placeholder:l==="approved"?"e.g., Please visit the school office with your documents.":"e.g., You may reapply next semester.",value:R,onChange:s=>y(s.target.value),className:"h-24"})]})}),e.jsxs(ge,{children:[e.jsx(r,{variant:"outline",onClick:()=>h(!1),disabled:d,children:"Cancel"}),e.jsx(r,{onClick:ce,disabled:d,className:l==="approved"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:d?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):`Confirm ${l==="approved"?"Approval":"Rejection"}`})]})]})})]})}export{as as default};
