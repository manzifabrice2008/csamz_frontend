import{c as T,d as ie,r as n,j as e,L as le}from"./index-CsgYaV5H.js";import{T as ne}from"./TeacherLayout-BHtakkNT.js";import{C as I,a as V,b as B,d as O,c as U}from"./card-CIYtGjiO.js";import{B as x}from"./ThemeToggle-Bwx1KZ0R.js";import{I as g}from"./input-D_Mj_V6e.js";import{T as $}from"./textarea-CFS7NNN8.js";import{B as v}from"./badge-CpS_Z_D6.js";import{S as H}from"./separator-B7Dx_tm4.js";import{t as oe,i as p}from"./api-BCzVkedE.js";import{L as _}from"./loader-circle-B_j-QHxK.js";import{S as Q}from"./square-pen-q17zO6lO.js";import{C as ce}from"./settings-rizTttmP.js";import{T as R}from"./trash-2-Rw-BK5zS.js";import{C as de}from"./circle-check-DpA1qW7O.js";import"./avatar-CGuztETI.js";import"./index-DH-MU9K0.js";import"./chevron-left-DXSgmS0_.js";import"./users-Drmh8jIn.js";import"./book-open-wK7-fWSF.js";import"./user-B0r-EK1A.js";import"./auth-yvpDPXXe.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=T("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=T("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=T("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]]);function De(){const{toast:i}=ie(),[o,G]=n.useState(null),[b,N]=n.useState([]),[X,Y]=n.useState(!0),[L,M]=n.useState(!1),[u,E]=n.useState(null),[d,m]=n.useState({title:"",description:"",total_marks:100,exam_code:"",level:"L3",trade:""}),[w,q]=n.useState(null),[l,S]=n.useState(null),[y,f]=n.useState([]),[J,F]=n.useState(!1),[D,P]=n.useState(!1),[j,z]=n.useState(null),[r,h]=n.useState({question_text:"",type:"MCQ",options:["","","",""],correct_answer:"",marks:1});n.useEffect(()=>{(async()=>{try{const t=oe.getStoredTeacher();t&&(G({trade:t.trade}),m(c=>({...c,trade:t.trade})));const a=await p.list();a.success&&N(a.exams)}catch{i({title:"Error",description:"Failed to load exams",variant:"destructive"})}finally{Y(!1)}})()},[i]);const A=async s=>{try{q(s),F(!0),S(null),f([]),C();const t=await p.getManageDetail(s);t.success&&(S(t.exam),f(t.questions))}catch{i({title:"Error",description:"Failed to load exam details",variant:"destructive"})}finally{F(!1)}},K=async s=>{if(s.preventDefault(),!d.title||!d.trade){i({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"});return}try{if(M(!0),u){const t=await p.update(u,d);t.success&&(i({title:"Success",description:"Exam updated successfully"}),N(b.map(a=>a.id===u?t.exam:a)),E(null),m(a=>({title:"",description:"",total_marks:100,exam_code:"",level:"L3",trade:a.trade})))}else{const t=await p.create({...d,exam_code:d.exam_code||void 0});t.success&&(i({title:"Success",description:"Exam created successfully"}),N([t.exam,...b]),m(a=>({title:"",description:"",total_marks:100,exam_code:"",level:"L3",trade:a.trade})),t.exam.id&&A(t.exam.id))}}catch(t){i({title:"Error",description:t.message||"Failed to save exam",variant:"destructive"})}finally{M(!1)}},W=s=>{E(s.id),m({title:s.title,description:s.description||"",total_marks:s.total_marks,exam_code:s.exam_code||"",level:s.level||"L3",trade:s.trade||""})},Z=()=>{E(null),m(s=>({title:"",description:"",total_marks:100,exam_code:"",level:"L3",trade:(o==null?void 0:o.trade)||s.trade}))},ee=async(s,t)=>{if(t.stopPropagation(),!!confirm("Are you sure you want to delete this exam? This action cannot be undone and will delete all questions within it."))try{await p.delete(s),N(b.filter(a=>a.id!==s)),w===s&&(q(null),S(null),f([])),i({title:"Success",description:"Exam deleted"})}catch{i({title:"Error",description:"Failed to delete exam",variant:"destructive"})}},C=()=>{z(null),h({question_text:"",type:"MCQ",options:["","","",""],correct_answer:"",marks:1})},se=s=>{z(s.id),h({question_text:s.question_text,type:s.type,options:s.type==="MCQ"?[...s.options]:["","","",""],correct_answer:s.correct_answer,marks:s.marks})},te=async s=>{if(s.preventDefault(),!!w){if(!r.question_text||!r.correct_answer){i({title:"Validation Error",description:"Please fill in question text and correct answer",variant:"destructive"});return}if(r.type==="MCQ"){const t=r.options.filter(a=>a.trim()!=="");if(t.length<2){i({title:"Validation Error",description:"MCQ must have at least 2 options",variant:"destructive"});return}if(!t.includes(r.correct_answer)){i({title:"Validation Error",description:"Correct answer must match one of the options exactly",variant:"destructive"});return}}try{P(!0);const t={question_text:r.question_text,type:r.type,options:r.type==="MCQ"?r.options.filter(c=>c):void 0,correct_answer:r.correct_answer,marks:r.marks};let a;if(j){const c=await p.updateQuestion(j,t);c.success&&(a=c.question,f(y.map(k=>k.id===j?a:k)),i({title:"Success",description:"Question updated"}),C())}else{const c=await p.addQuestion(w,t);c.success&&(a=c.question,f([...y,a]),i({title:"Success",description:"Question added"}),C())}}catch(t){i({title:"Error",description:t.message||"Failed to save question",variant:"destructive"})}finally{P(!1)}}},ae=async s=>{if(confirm("Are you sure you want to delete this question?"))try{await p.deleteQuestion(s),f(y.filter(t=>t.id!==s)),i({title:"Success",description:"Question deleted"})}catch{i({title:"Error",description:"Failed to delete question",variant:"destructive"})}},re=()=>{l!=null&&l.exam_code&&(navigator.clipboard.writeText(l.exam_code),i({title:"Copied",description:"Exam code copied to clipboard"}))};return e.jsx(ne,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Teacher Exams"}),e.jsx("p",{className:"text-muted-foreground",children:"Prepare and manage online assessments"}),(o==null?void 0:o.trade)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Linked trade: ",o.trade,". Students in this trade will see your exams."]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.1fr_0.9fr]",children:[e.jsxs(I,{className:"shadow-lg",children:[e.jsxs(V,{children:[e.jsxs(B,{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-school-primary"}),u?"Edit Exam":"Create or select an exam"]}),u&&e.jsx(x,{variant:"ghost",size:"sm",onClick:Z,children:"Cancel"})]}),e.jsx(O,{children:u?"Update exam details.":"Generate an exam code automatically or choose your own."})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Exam title"}),e.jsx(g,{value:d.title,onChange:s=>m(t=>({...t,title:s.target.value})),placeholder:"e.g. Software Development Mock Test",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Description"}),e.jsx($,{value:d.description,onChange:s=>m(t=>({...t,description:s.target.value})),placeholder:"Optional overview for students"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Total marks"}),e.jsx(g,{type:"number",min:0,value:d.total_marks,onChange:s=>m(t=>({...t,total_marks:Number(s.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Custom exam code (optional)"}),e.jsx(g,{value:d.exam_code,onChange:s=>m(t=>({...t,exam_code:s.target.value.toUpperCase()})),placeholder:"EX-ABC123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Level"}),e.jsxs("select",{value:d.level,onChange:s=>m(t=>({...t,level:s.target.value})),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"L3",children:"Level 3"}),e.jsx("option",{value:"L4",children:"Level 4"}),e.jsx("option",{value:"L5",children:"Level 5"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Trade"}),e.jsx(g,{value:d.trade,onChange:s=>m(t=>({...t,trade:s.target.value})),placeholder:"Enter trade name",required:!0,disabled:!!(o!=null&&o.trade),className:o!=null&&o.trade?"bg-muted text-muted-foreground":""})]})]}),e.jsx(x,{type:"submit",className:"w-full",disabled:L,children:L?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 animate-spin mr-2"}),u?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[u?e.jsx(Q,{className:"w-4 h-4 mr-2"}):e.jsx(me,{className:"w-4 h-4 mr-2"}),u?"Update exam":"Create exam"]})})]}),e.jsx(H,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Your exams"}),X?e.jsxs("div",{className:"flex items-center justify-center py-8 text-muted-foreground",children:[e.jsx(_,{className:"w-5 h-5 animate-spin mr-2"}),"Loading exams..."]}):b.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No exams yet. Create one to get started."}):e.jsx("div",{className:"space-y-3 max-h-[420px] overflow-auto pr-1",children:b.map(s=>e.jsxs("button",{onClick:()=>A(s.id),className:`w-full text-left border rounded-lg p-4 transition ${w===s.id?"border-school-primary bg-school-primary/5":"border-border hover:border-school-primary/60"}`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium",children:s.title}),s.exam_code&&e.jsx(v,{variant:"outline",className:"text-xs",children:s.exam_code})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(v,{variant:"secondary",className:"text-xs",children:s.trade||"No Trade"}),e.jsx(v,{variant:"secondary",className:"text-xs",children:s.level||"No Level"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.question_count??0," questions • ",s.total_marks," marks"]})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground",title:"View Results",asChild:!0,onClick:t=>t.stopPropagation(),children:e.jsx(le,{to:`/teacher/exams/${s.id}/results`,children:e.jsx(ce,{className:"w-4 h-4"})})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:t=>{t.stopPropagation(),W(s)},children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:t=>ee(s.id,t),children:e.jsx(R,{className:"w-4 h-4"})})]})]})]},s.id))})]})]})]}),e.jsxs(I,{className:"shadow-lg",children:[e.jsxs(V,{children:[e.jsx(B,{children:"Exam questions"}),e.jsx(O,{children:l?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:l.title}),l.exam_code&&e.jsxs("button",{type:"button",onClick:re,className:"inline-flex items-center gap-1 text-xs text-school-primary hover:underline",children:[e.jsx(ue,{className:"w-3 h-3"}),l.exam_code]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.trade&&e.jsx(v,{variant:"secondary",className:"text-xs",children:l.trade}),e.jsx(v,{variant:"secondary",className:"text-xs",children:l.level}),l.teacher_name&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["by ",l.teacher_name]})]})]}):"Select an exam to view and edit questions."})]}),e.jsx(U,{className:"space-y-6",children:J?e.jsxs("div",{className:"flex items-center justify-center py-10 text-muted-foreground",children:[e.jsx(_,{className:"w-6 h-6 animate-spin mr-2"}),"Loading questions..."]}):l?e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"space-y-4",onSubmit:te,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg",children:j?"Edit question":"Add new question"}),j&&e.jsx(x,{variant:"ghost",size:"sm",onClick:C,children:"Cancel edit"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Question text"}),e.jsx($,{value:r.question_text,onChange:s=>h(t=>({...t,question_text:s.target.value})),required:!0,placeholder:"Enter the question"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Question type"}),e.jsxs("select",{value:r.type,onChange:s=>{const t=s.target.value;h(a=>({...a,type:t,correct_answer:t==="TF"?"True":a.correct_answer}))},className:"w-full rounded-md border border-border bg-background px-3 py-2",children:[e.jsx("option",{value:"MCQ",children:"Multiple choice"}),e.jsx("option",{value:"TF",children:"True / False"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Marks"}),e.jsx(g,{type:"number",min:1,value:r.marks,onChange:s=>h(t=>({...t,marks:Number(s.target.value)}))})]})]}),r.type==="MCQ"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium block",children:"Options"}),r.options.map((s,t)=>e.jsx(g,{value:s,placeholder:`Option ${t+1}`,onChange:a=>{const c=[...r.options];c[t]=a.target.value,h(k=>({...k,options:c}))}},t)),e.jsx("label",{className:"text-sm font-medium block mt-2",children:"Correct answer"}),e.jsxs("select",{value:r.correct_answer,onChange:s=>h(t=>({...t,correct_answer:s.target.value})),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx("option",{value:"",children:"Select the correct option"}),r.options.map((s,t)=>s.trim()!==""&&e.jsx("option",{value:s,children:s},t))]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Correct answer"}),e.jsxs("select",{value:r.correct_answer||"True",onChange:s=>h(t=>({...t,correct_answer:s.target.value})),className:"w-full rounded-md border border-border bg-background px-3 py-2",children:[e.jsx("option",{value:"True",children:"True"}),e.jsx("option",{value:"False",children:"False"})]})]}),e.jsx(x,{type:"submit",className:"w-full",disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 animate-spin mr-2"}),"Saving..."]}):j?"Update question":"Add question"})]}),e.jsx(H,{}),e.jsx("div",{className:"space-y-4 max-h-[420px] overflow-auto pr-1",children:y.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No questions yet. Add one above."}):y.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.question_text}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.type==="MCQ"?"Multiple choice":"True / False"," • ",s.marks," marks"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>se(s),children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>ae(s.id),children:e.jsx(R,{className:"w-4 h-4"})})]})]}),s.type==="MCQ"?e.jsx("ul",{className:"list-disc pl-5 text-sm space-y-1",children:s.options.map(t=>e.jsxs("li",{className:"flex items-center gap-2",children:[t,t===s.correct_answer&&e.jsxs(v,{variant:"outline",className:"text-emerald-600 border-emerald-200",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Correct"]})]},t))}):e.jsxs("p",{className:"text-sm",children:["Correct answer:"," ",e.jsx(v,{variant:"outline",className:"ml-2",children:s.correct_answer})]})]},s.id))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select an exam to begin editing questions."})})]})]})]})})}export{De as default};
