import{r as n,d as ie,j as e}from"./index-CsgYaV5H.js";import{A as ne}from"./AdminLayout-2CmIMh1F.js";import{B as p}from"./ThemeToggle-Bwx1KZ0R.js";import{I as q}from"./input-D_Mj_V6e.js";import{T as z}from"./textarea-CFS7NNN8.js";import{C as S,a as G,b as M,c as _}from"./card-CIYtGjiO.js";import{n as N,A as P}from"./api-BCzVkedE.js";import{g as O}from"./auth-yvpDPXXe.js";import{P as oe}from"./plus-Tblid5y_.js";import{C as H}from"./calendar-BAfAoDvC.js";import{T as J}from"./tag-jU8fqPh1.js";import{L as U}from"./loader-circle-B_j-QHxK.js";import{I as ce}from"./image-B4LI1LHi.js";import{S as me}from"./star-DV39TtCt.js";import{T as W}from"./trash-2-Rw-BK5zS.js";import{C as de}from"./circle-alert-nJEP4JXW.js";import{S as ue}from"./square-pen-q17zO6lO.js";import"./settings-rizTttmP.js";import"./chevron-left-DXSgmS0_.js";import"./users-Drmh8jIn.js";import"./newspaper-INFz-W6c.js";function De(){const[y,K]=n.useState([]),[u,w]=n.useState(!1),[A,k]=n.useState(null),[o,f]=n.useState(!1),[Q,F]=n.useState(!0),[D,x]=n.useState(null),[j,v]=n.useState(Array(5).fill(!1)),[h,g]=n.useState(Array(5).fill(null)),I=n.useRef(Array(5).fill(null)),[V,T]=n.useState([]),[$,C]=n.useState([]),E=t=>{if(!t||t.trim()==="")return"";if(/^https?:\/\//i.test(t))return t;const s=P.replace(/\/api$/,"");return t.startsWith("/")?`${s}${t}`:`${s}/${t}`},X=async(t,s)=>{const r=new FormData;r.append("image",t);try{const a=await fetch(`${P}/upload/image`,{method:"POST",headers:{Authorization:`Bearer ${O()}`},body:r});if(!a.ok)throw new Error("Image upload failed");return(await a.json()).url}catch(a){throw console.error("Error uploading image:",a),a}},{toast:m}=ie(),[l,c]=n.useState({title:"",published_date:"",category:"",excerpt:"",content:"",image_urls:["","","","",""]}),Y=t=>{if(!t)return null;try{const a=new URL(t,window.location.origin).pathname.split("/").filter(Boolean);return a.length?a[a.length-1]:null}catch{const a=t.split("?")[0].split("/").filter(Boolean);return a.length?a[a.length-1]:null}},L=async t=>{const s=Y(t);if(s)try{const r=await fetch(`${P}/upload/image/${encodeURIComponent(s)}`,{method:"DELETE",headers:{Authorization:`Bearer ${O()}`}});r.ok||console.warn("Failed to delete image from server",await r.text())}catch(r){console.error("Error deleting image:",r)}};n.useEffect(()=>{b()},[]);const b=async()=>{try{F(!0),x(null);const t=await N.getAll();K(t.articles)}catch(t){x(t.message||"Failed to fetch articles"),m({title:"Error",description:t.message||"Failed to fetch articles",variant:"destructive"})}finally{F(!1)}},Z=async t=>{t.preventDefault(),f(!0),x(null);try{const s=l.image_urls.map(a=>a.trim()).filter(a=>a.length>0),r={...l,image_urls:s};u&&A?(await N.update(A.id,r),m({title:"Success",description:"Article updated successfully"}),$.length&&await Promise.all($.map(a=>L(a)))):(await N.create(r),m({title:"Success",description:"Article created successfully"})),B(),b()}catch(s){x(s.message||"Failed to save article"),m({title:"Error",description:s.message||"Failed to save article",variant:"destructive"})}finally{f(!1)}},ee=t=>{w(!0),k(t);const s=t.image_urls||[];c({title:t.title,excerpt:t.excerpt,content:t.content||"",category:t.category,image_urls:[...s,...Array(5-s.length).fill("")].slice(0,5),published_date:t.published_date});const r=Array(5).fill(null);s.forEach((a,i)=>{a&&(r[i]=E(a))}),g(r),v(Array(5).fill(!1)),T(s),C([]),w(!0),window.scrollTo({top:0,behavior:"smooth"})},te=async(t,s)=>{if(t.target.files&&t.target.files[0]){const r=t.target.files[0],a=[...j];a[s]=!0,v(a);try{const i=await X(r,s),d=[...h];d[s]=E(i),g(d);const R=[...l.image_urls];R[s]=i,c({...l,image_urls:R})}catch{m({title:"Error",description:"Failed to upload image. Please try again.",variant:"destructive"})}finally{const i=[...j];i[s]=!1,v(i)}}},se=async t=>{const s=[...l.image_urls],r=s[t];s[t]="";const a=[...h];a[t]=null,c({...l,image_urls:s}),g(a),I.current[t]&&(I.current[t].value=""),r&&(u&&A&&V.includes(r)?C(i=>i.includes(r)?i:[...i,r]):await L(r))},ae=t=>{if(t<=0)return;const s=[...l.image_urls],[r]=s.splice(t,1);s.unshift(r);const a=[...h],[i]=a.splice(t,1);a.unshift(i),c({...l,image_urls:[...s]}),g([...a])},re=async t=>{if(confirm("Are you sure you want to delete this article?"))try{f(!0),await N.delete(t),m({title:"Success",description:"Article deleted successfully"}),await b()}catch(s){m({title:"Error",description:s.message||"Failed to delete article",variant:"destructive"})}finally{f(!1)}},B=()=>{w(!1),k(null),c({title:"",published_date:"",category:"",excerpt:"",content:"",image_urls:["","","","",""]}),g(Array(5).fill(null)),v(Array(5).fill(!1)),T([]),C([])},le=()=>{B()};return e.jsx(ne,{children:e.jsx("section",{className:"p-6",children:e.jsxs("div",{className:"container mx-auto max-w-7xl",children:[e.jsxs("div",{className:"mb-8 animate-fadeInDown",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:e.jsx("span",{className:"gradient-text",children:"News Management"})}),e.jsx("p",{className:"text-muted-foreground",children:"Manage news articles and updates"})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs(S,{className:"shadow-lg hover-lift animate-fadeInLeft",children:[e.jsx(G,{children:e.jsxs(M,{className:"text-2xl text-school-primary dark:text-school-accent flex items-center gap-2",children:[e.jsx(oe,{className:"w-6 h-6"}),u?"Edit News Article":"Add New Article"]})}),e.jsx(_,{children:e.jsxs("form",{onSubmit:Z,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Article Title"}),e.jsx(q,{placeholder:"Enter article title",value:l.title,onChange:t=>c({...l,title:t.target.value}),required:!0,disabled:o,className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-2 block flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Date"]}),e.jsx(q,{type:"date",value:l.published_date,onChange:t=>c({...l,published_date:t.target.value}),required:!0,disabled:o})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-2 block flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Category"]}),e.jsxs("select",{value:l.category,onChange:t=>c({...l,category:t.target.value}),required:!0,disabled:o,className:"w-full p-2 border rounded-md bg-background text-foreground",children:[e.jsx("option",{value:"",children:"Select category"}),e.jsx("option",{value:"Achievements",children:"Achievements"}),e.jsx("option",{value:"Facilities",children:"Facilities"}),e.jsx("option",{value:"Partnerships",children:"Partnerships"}),e.jsx("option",{value:"Events",children:"Events"}),e.jsx("option",{value:"Announcements",children:"Announcements"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"News Images (Up to 5)"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[0,1,2,3,4].map(t=>e.jsxs("div",{className:"relative",children:[e.jsxs("label",{htmlFor:`image-upload-${t}`,className:"block cursor-pointer border-2 border-dashed rounded-md p-4 w-full h-48 flex flex-col items-center justify-center hover:bg-accent/20 transition-colors",children:[j[t]?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(U,{className:"w-8 h-8 animate-spin text-school-primary"})}):h[t]?e.jsx("div",{className:"relative w-full h-full",children:e.jsx("img",{src:h[t]||"",alt:`Preview ${t+1}`,className:"w-full h-full object-cover rounded-md",onError:s=>{s.target.src="/placeholder.svg"}})}):e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{className:"w-8 h-8 mb-2 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Image ",t+1]})]}),e.jsx("input",{id:`image-upload-${t}`,name:`image-upload-${t}`,type:"file",className:"sr-only",onChange:s=>te(s,t),accept:"image/*",ref:s=>I.current[t]=s})]}),!j[t]&&l.image_urls[t]&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-20",children:[t>0&&e.jsx("button",{type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),ae(t)},className:"bg-amber-500 text-white rounded-full p-1 hover:bg-amber-600 transition-colors",title:"Set as primary image",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),se(t)},className:"bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",title:"Remove image",children:e.jsx(W,{className:"w-4 h-4"})})]})]},t))}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Upload up to 5 images (PNG, JPG, GIF up to 5MB each)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Excerpt"}),e.jsx(z,{placeholder:"Enter article excerpt...",value:l.excerpt,onChange:t=>c({...l,excerpt:t.target.value}),required:!0,disabled:o,className:"h-24"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Full Content (Optional)"}),e.jsx(z,{placeholder:"Enter full article content...",value:l.content,onChange:t=>c({...l,content:t.target.value}),disabled:o,className:"h-32"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(p,{type:"submit",disabled:o,className:"flex-1 bg-school-primary dark:bg-school-accent hover:bg-school-primary/90 dark:hover:bg-school-accent/90 transform hover:scale-105 transition-all duration-300",children:o?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2 animate-spin"}),u?"Updating...":"Publishing..."]}):u?"Update Article":"Publish Article"}),u&&e.jsx(p,{type:"button",variant:"outline",onClick:le,disabled:o,className:"flex-1",children:"Cancel"})]})]})})]}),e.jsx("div",{className:"animate-fadeInRight",children:e.jsxs(S,{className:"shadow-lg",children:[e.jsx(G,{children:e.jsxs(M,{className:"text-2xl text-school-primary dark:text-school-accent",children:["Published Articles (",y.length,")"]})}),e.jsx(_,{children:Q?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(U,{className:"w-8 h-8 animate-spin text-school-primary"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading articles..."})]}):D?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-red-500",children:[e.jsx(de,{className:"w-8 h-8 mb-2"}),e.jsx("p",{children:D}),e.jsx(p,{onClick:b,variant:"outline",className:"mt-4",children:"Retry"})]}):e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:y.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No articles yet. Create your first article!"}):y.map((t,s)=>e.jsx(S,{className:`hover-lift animate-scaleIn delay-${(s+1)*100}`,children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[(()=>{var i;const r=(i=t.image_urls)==null?void 0:i.find(d=>d&&d.trim().length>0),a=r?E(r):"";return a?e.jsx("img",{src:a,alt:t.title,className:"w-24 h-24 object-cover rounded-lg",onError:d=>{d.target.src="/placeholder.svg"}}):e.jsx("div",{className:"w-24 h-24 rounded-lg bg-muted flex items-center justify-center text-muted-foreground text-xs",children:"No Image"})})(),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-foreground mb-1",children:t.title}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),new Date(t.published_date).toLocaleDateString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),t.category]})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.excerpt}),t.author_name&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["By: ",t.author_name]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{size:"sm",variant:"outline",onClick:()=>ee(t),disabled:o,className:"hover:bg-school-primary hover:text-white",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>re(t.id),disabled:o,className:"hover:bg-red-500 hover:text-white",children:e.jsx(W,{className:"w-4 h-4"})})]})]})})},t.id))})})]})})]})]})})})}export{De as default};
